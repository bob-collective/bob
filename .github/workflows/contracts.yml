name: Contracts

on: [pull_request]

env:
  FOUNDRY_PROFILE: ci
  BOB_PROD_PUBLIC_RPC_URL: "https://rpc.gobob.xyz/"

jobs:
  tests:
    name: Tests
    runs-on: ubuntu-latest
    permissions:
      contents: write
    defaults:
      run:
        working-directory: contracts
    steps:
      - uses: actions/checkout@v6
        with:
          submodules: recursive
      - name: Install Foundry
        uses: foundry-rs/foundry-toolchain@v1
        with:
          version: v1.3.6
      - name: Install deps (with retries)
        run: |
          for i in {1..5}; do
            forge soldeer install && break || sleep 10
          done
      - name: Run forge tests
        run: |
          forge test -vvv --deny-warnings
      - name: Check fmt
        run: forge fmt --check
      - name: Versions
        run: |
          forge --version
          git submodule status
